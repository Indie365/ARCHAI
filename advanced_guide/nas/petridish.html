
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Petridish &#8212; Archai</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Implementing DARTS" href="implementing_darts.html" />
    <link rel="prev" title="Available Algorithms" href="available_algorithms.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/package_structure.html">
   Package Structure
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../basic_guide/tutorial.html">
   30-Minute Tutorial
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basic_guide/notebooks.html">
   Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../basic_guide/notebooks/discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/search_space.html">
       Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/objectives.html">
       Objectives
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/search_algos.html">
       Search Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/config_search.html">
       Config Search
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basic_guide/notebooks/nlp.html">
     Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../basic_guide/examples_scripts.html">
   Examples &amp; Scripts
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../nas.html">
   Neural Architecture Search
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="available_algorithms.html">
     Available Algorithms
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Petridish
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="implementing_darts.html">
     Implementing DARTS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cv.html">
   Computer Vision
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../nlp.html">
   Natural Language Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/training.html">
     Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/evaluation.html">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../large_scale_training.html">
   Large-Scale Training
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../large_scale_training/deepspeed.html">
     DeepSpeed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../large_scale_training/fsdp.html">
     Fully Shared Data Parallel (FSDP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../devops.html">
   DevOps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../devops/azure.html">
     Azure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Benchmarks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../benchmark/food_101.html">
   Food-101
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/first_contribution.html">
   First Contribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/documentation.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/unitary_tests.html">
   Unitary Tests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/copyright.html">
   Copyright
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../reference/api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.algos.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.darts.html">
       DARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.didarts.html">
       DiDARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.divnas.html">
       DivNAS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.gumbelsoftmax.html">
       Gumbel-Softmax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.manual.html">
       Manual
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.nasbench101.html">
       NasBench-101
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.petridish.html">
       Petridish
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.random.html">
       Random
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.xnas.html">
       XNAS
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.cifar10_models.html">
     CIFAR-10 Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.common.html">
     Common Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.data_aug.html">
     Data Augmentation
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.datasets.html">
     Datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.datasets.providers.html">
       Providers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.datasets.transforms.html">
       Transforms
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.algos.html">
       Search algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.api.html">
       Discrete Search API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.datasets.html">
       Datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.objectives.html">
       Bultin search objectives
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.predictors.html">
       Predictors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.search_spaces.html">
       Bultin Discrete Search Spaces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.nas.html">
     Neural Architecture Search
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.networks.html">
     Networks
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.networks.shakeshake.html">
       ShakeShake
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.nlp.html">
     Natural Language Processing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.datasets.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.datasets.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.eval.html">
       Evaluation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.harness.html">
         Harness
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.profiler.html">
         Profiler
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.text_predict.html">
         Text Predict
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.nlp.objectives.html">
       Objectives
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.onnx.html">
       ONNX
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
      <label for="toctree-checkbox-15">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.onnx.config_utils.html">
         Configuration Utilities
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.onnx.optimization_utils.html">
         Optimization Utilities
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.nlp.quantization.html">
       Quantization
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.search_spaces.html">
       Search Spaces
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.search_spaces.transformer_flex.html">
         Transformer-Flex
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.trainers.html">
       Trainers
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.trainers.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.trainers.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/microsoft/archai"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/issues/new?title=Issue%20on%20page%20%2Fadvanced_guide/nas/petridish.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/edit/master/advanced_guide/nas/petridish.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Sections
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search">
   Search
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-it-all-together">
   Putting It All Together
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Petridish</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Sections </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search">
   Search
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-it-all-together">
   Putting It All Together
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="petridish">
<h1>Petridish<a class="headerlink" href="#petridish" title="Permalink to this headline">#</a></h1>
<p>Petridish is a NAS algorithm that grows networks starting from any network. It typically starts with a small, hand-specified network, but any set of networks can be used as seed networks. In each search iteration, Petridish evaluates several candidates and selects the most promising ones to add to the parent network. It then trains this modified network for a few more epochs before adding them back to the parent pool for further growth consideration.</p>
<p>Only those parent architectures that lie close to the convex hull of the Pareto-frontier (which serves as an upper bound of the error-vs-multiply-adds or error-vs-flops or error-vs-memory curve) are selected for further growth. The idea is that only models that are currently near the estimated Pareto-frontier have a realistic chance of lowering the curve by producing children models.</p>
<p>Before continuing, it is recommended that readers familiarize themselves with the details of Petridish by reading the <a class="reference external" href="https://www.microsoft.com/en-us/research/publication/efficient-forward-architecture-search">paper at NeuRIPS 2019</a>, reading the <a class="reference external" href="https://www.microsoft.com/en-us/research/blog/project-petridish-efficient-forward-neural-architecture-search">blog post</a>, or watching the <a class="reference external" href="https://youtu.be/sZMZ6nJFaJY?t=2648">online lecture</a>. Additionally, readers should familiarize themselves with the core of Archai and follow the <a class="reference internal" href="../../basic_guide/tutorial.html"><span class="doc">30-minute tutorial</span></a> for additional context.</p>
<section id="search">
<h2>Search<a class="headerlink" href="#search" title="Permalink to this headline">#</a></h2>
<p>The core of Petridish’s functionality is in the <code class="docutils literal notranslate"><span class="pre">SearcherPetridish</span></code> class which derives from the <code class="docutils literal notranslate"><span class="pre">SearchCombinations</span></code> class. The <code class="docutils literal notranslate"><span class="pre">search()</span></code> function in the <a class="reference external" href="https://github.com/microsoft/archai/tree/main/searcher_petridish.py">searcher_petridish.py</a> file contains the main search logic.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># seed the pool with many models of different</span>
<span class="c1"># macro parameters like number of cells, reductions etc if parent pool</span>
<span class="c1"># could not be restored and/or this is the first time this job has been run.</span>
<span class="n">future_ids</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">is_restored</span> <span class="k">else</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_create_seed_jobs</span><span class="p">(</span><span class="n">conf_search</span><span class="p">,</span>
                                                            <span class="n">model_desc_builder</span><span class="p">)</span>
</pre></div>
</div>
<p>The search process is first seeded with a number of models, each of which differs in the number of cells (normal or reduction) and number of nodes within each cell. This is done using the <code class="docutils literal notranslate"><span class="pre">self._create_seed_jobs</span></code> function and the <code class="docutils literal notranslate"><span class="pre">ray</span></code> package to train the seed models in parallel (one seed model per available GPU). Note that this is done asynchronously, and the function does not block but just queues up the jobs and returns immediately. The actual training is handled by the <code class="docutils literal notranslate"><span class="pre">self._train_model_desc_dist</span></code> ray remote function call.</p>
<p>During the search process, the function checks if the search is done and, if not, gets the first completed job and updates the convex hull with the results. It then samples a point from the hull and searches for a model based on that point. The searched model is then trained and added to the pool for further consideration. This process continues until the search is complete.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_search_done</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ray jobs running: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">future_ids</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">future_ids</span><span class="p">:</span>
        <span class="c1"># get first completed job</span>
        <span class="n">job_id_done</span><span class="p">,</span> <span class="n">future_ids</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">future_ids</span><span class="p">)</span>

        <span class="n">hull_point</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_id_done</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hull point id </span><span class="si">{</span><span class="n">hull_point</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> with stage </span><span class="si">{</span><span class="n">hull_point</span><span class="o">.</span><span class="n">job_stage</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> completed&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hull_point</span><span class="o">.</span><span class="n">is_trained_stage</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_convex_hull</span><span class="p">(</span><span class="n">hull_point</span><span class="p">)</span>

            <span class="c1"># sample a point and search</span>
            <span class="n">sampled_point</span> <span class="o">=</span> <span class="n">sample_from_hull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hull_points</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_convex_hull_eps</span><span class="p">)</span>

            <span class="n">future_id</span> <span class="o">=</span> <span class="n">SearcherPetridish</span><span class="o">.</span><span class="n">search_model_desc_dist</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">conf_search</span><span class="p">,</span> <span class="n">sampled_point</span><span class="p">,</span> <span class="n">model_desc_builder</span><span class="p">,</span> <span class="n">trainer_class</span><span class="p">,</span>
                <span class="n">finalizers</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="n">future_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Added sampled point </span><span class="si">{</span><span class="n">sampled_point</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> for search&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hull_point</span><span class="o">.</span><span class="n">job_stage</span><span class="o">==</span><span class="n">JobStage</span><span class="o">.</span><span class="n">SEARCH</span><span class="p">:</span>
            <span class="c1"># create the job to train the searched model</span>
            <span class="n">future_id</span> <span class="o">=</span> <span class="n">SearcherPetridish</span><span class="o">.</span><span class="n">train_model_desc_dist</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">conf_post_train</span><span class="p">,</span> <span class="n">hull_point</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="n">future_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Added sampled point </span><span class="si">{</span><span class="n">hull_point</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> for post-search training&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job stage &quot;</span><span class="si">{</span><span class="n">hull_point</span><span class="o">.</span><span class="n">job_stage</span><span class="si">}</span><span class="s1">&quot; is not expected in search loop&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above block of code we wait for any job in the queue to be completed in the <code class="docutils literal notranslate"><span class="pre">hull_point</span> <span class="pre">=</span> <span class="pre">ray.get(job_id_done[0])</span></code> line. Jobs returning from the pool can be either a trained seed or trained search model, or search model. By wrapping the job in a <code class="docutils literal notranslate"><span class="pre">ConvexHullPoint</span></code> class we can do bookkeeping on job stage and other meta-data.</p>
<p>If a seed model or a trained search model finishes, we add it to the convex hull (<code class="docutils literal notranslate"><span class="pre">self._update_convex_hull(hull_point)</span></code>) and sample a new model from the current estimate of the convex hull and send it to a child ray process where search over promising candidate layers is carried out. This is encapsulated in the <code class="docutils literal notranslate"><span class="pre">SearcherPetridish.search_model_desc_dist</span></code> remote ray function.</p>
<p>If a model in the search stage finishes it is sent to a ray child process (<code class="docutils literal notranslate"><span class="pre">self.train_model_desc_dist</span></code>) for further training where now the chosen candidate layer gets to affect the parent network’s gradient flow.</p>
<p>Now let’s look at some key parameters in the configuration file <a class="reference external" href="https://github.com/microsoft/archai/tree/main/benchmarks/confs/algos/petridish.yaml">benchmarks/confs/algos/petridish.yaml</a> which controls key aspects of the pareto-frontier search process.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">petridish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">convex_hull_eps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.025</span><span class="w"> </span><span class="c1"># tolerance</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_madd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200000000</span><span class="w"> </span><span class="c1"># if any parent model reaches this many multiply-additions then the search is terminated or it reaches maximum number of parent pool size</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_hull_points</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"> </span><span class="c1"># if the pool of parent models reaches this size then search is terminated or if it reaches max multiply-adds</span><span class="w"></span>
<span class="w">    </span><span class="nt">checkpoints_foldername</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$expdir/petridish_search_checkpoints&#39;</span><span class="w"></span>
<span class="nt">pareto</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_cells</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_reductions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_nodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># if false then there will only be one seed model. if true a number of seed models with different number of cells, reductions and nodes will be used to initialize the search. this provides more coverage of the frontier.</span><span class="w"></span>
<span class="nt">model_desc</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_cells</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_reductions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">num_edges_to_sample</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># number of edges each node will take inputs from</span><span class="w"></span>
</pre></div>
</div>
<p>We have reproduced some key parts of the configuration file above. <code class="docutils literal notranslate"><span class="pre">petridish/convex_hull_eps</span></code> defines the tolerance value used to define a region around the lower convex hull of the
error-flops or error-multiply-additions plot. From this region parent models are sampled to have a chance at producing children. <code class="docutils literal notranslate"><span class="pre">max_madd</span></code> currently set to 200M, means if any model is encountered which exceeds this threshold, the entire search process will be terminated. <code class="docutils literal notranslate"><span class="pre">max_hull_points</span></code> number of models are in the pool of parents then search is terminated as well. These parameters jointly control how long you want to continue search for and where you want to concentrate compute for search.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pareto</span></code> section defines the maximum number of total cells, reduction cells and nodes to have in the skeleton of the architecture. Combined with the minimum values from the <code class="docutils literal notranslate"><span class="pre">model_desc</span></code> section, <cite>self._create_seed_jobs</cite> will enumerate these models.</p>
<img alt="Gallery of models on the pareto-frontier curve" src="../../_images/convex_hull.png" />
</section>
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">#</a></h2>
<p>After Petridish generates a gallery of models, they are trained for a longer period of time (usually 600 or 1500 epochs) with potential enhancements like AutoAugment preprocessing or CutOut.</p>
<p>The evaluation of these models is carried out using the Evaluater class and distributed parallel training on available GPUs on the same machine with the help of ray.</p>
<p>The following image shows the Accuracy vs. multiply-additions gallery, with an example model at 328M multiply-additions achieving 97.23% top-1 accuracy on CIFAR10 with 3M parameters and using 600 epochs.</p>
<img alt="Accuracy vs. multiply-additions after evaluation" src="../../_images/model_gallery_accuracy_madds.png" />
</section>
<section id="putting-it-all-together">
<h2>Putting It All Together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline">#</a></h2>
<p>The process detailed in the <a class="reference internal" href="../../basic_guide/tutorial.html"><span class="doc">30-minute tutorial</span></a> is used to generate a <code class="docutils literal notranslate"><span class="pre">PetridishModelBuilder</span></code> and <code class="docutils literal notranslate"><span class="pre">EvaluaterPetridish</span></code> which are communicated to Archai via the <code class="docutils literal notranslate"><span class="pre">PetridishExperimentRunner</span></code> class and run using <code class="docutils literal notranslate"><span class="pre">main.py</span></code>.</p>
<p>Note that Petridish is not limited to searching pareto-frontiers of error-vs-multiply-additions only. The x-axis can easily be changed to other quantities like flops, memory, number of parameters, intensity, etc. By modifying the search termination criteria and the models used to seed the search process, one can control the part of the x-axis that receives the most compute.</p>
<p>We welcome feedback, user stories, and real-world scenarios that can be improved with the help of Petridish.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="available_algorithms.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Available Algorithms</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="implementing_darts.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Implementing DARTS</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft<br/>
  
      &copy; Copyright 2022.<br/>
    Last updated on Dec 21, 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>