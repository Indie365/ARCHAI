
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Search Algorithms &#8212; Archai</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Config Search Spaces" href="config_search.html" />
    <link rel="prev" title="Objective functions" href="objectives.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../getting_started/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../getting_started/quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../getting_started/package_structure.html">
   Package Structure
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../tutorial.html">
   30-Minute Tutorial
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../notebooks.html">
   Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../discrete_search.html">
     Discrete Search
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="search_space.html">
       Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="objectives.html">
       Objectives
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Search Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="config_search.html">
       Config Search
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp.html">
     Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../examples_scripts.html">
   Examples &amp; Scripts
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/nas.html">
   Neural Architecture Search
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nas/available_algorithms.html">
     Available Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nas/petridish.html">
     Petridish
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nas/implementing_darts.html">
     Implementing DARTS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../advanced_guide/cv.html">
   Computer Vision
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/nlp.html">
   Natural Language Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/training.html">
     Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/evaluation.html">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/large_scale_training.html">
   Large-Scale Training
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/large_scale_training/deepspeed.html">
     DeepSpeed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/large_scale_training/fsdp.html">
     Fully Shared Data Parallel (FSDP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/devops.html">
   DevOps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/devops/azure.html">
     Azure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Benchmarks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../benchmark/food_101.html">
   Food-101
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/first_contribution.html">
   First Contribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/documentation.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/unitary_tests.html">
   Unitary Tests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/copyright.html">
   Copyright
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../reference/api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.algos.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.darts.html">
       DARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.didarts.html">
       DiDARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.divnas.html">
       DivNAS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.gumbelsoftmax.html">
       Gumbel-Softmax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.manual.html">
       Manual
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.nasbench101.html">
       NasBench-101
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.petridish.html">
       Petridish
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.random.html">
       Random
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.algos.xnas.html">
       XNAS
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.cifar10_models.html">
     CIFAR-10 Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.common.html">
     Common Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.data_aug.html">
     Data Augmentation
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.datasets.html">
     Datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.datasets.providers.html">
       Providers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.datasets.transforms.html">
       Transforms
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.algos.html">
       Search algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.api.html">
       Discrete Search API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.datasets.html">
       Datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.objectives.html">
       Bultin search objectives
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.predictors.html">
       Predictors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.html">
       Bultin Discrete Search Spaces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.nas.html">
     Neural Architecture Search
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.networks.html">
     Networks
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.networks.shakeshake.html">
       ShakeShake
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.nlp.html">
     Natural Language Processing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.nlp.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.datasets.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.datasets.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.nlp.eval.html">
       Evaluation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.eval.harness.html">
         Harness
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.eval.profiler.html">
         Profiler
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.eval.text_predict.html">
         Text Predict
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.nlp.objectives.html">
       Objectives
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.nlp.onnx.html">
       ONNX
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
      <label for="toctree-checkbox-15">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.onnx.config_utils.html">
         Configuration Utilities
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.onnx.optimization_utils.html">
         Optimization Utilities
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.nlp.quantization.html">
       Quantization
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.nlp.search_spaces.html">
       Search Spaces
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.search_spaces.transformer_flex.html">
         Transformer-Flex
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.nlp.trainers.html">
       Trainers
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.trainers.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.nlp.trainers.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reference/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reference/changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/microsoft/archai"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/issues/new?title=Issue%20on%20page%20%2Fbasic_guide/notebooks/discrete_search/search_algos.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/edit/master/basic_guide/notebooks/discrete_search/search_algos.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Sections
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Dataset-Provider">
   Dataset Provider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Search-objectives">
   Search objectives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Choosing-a-search-algorithm">
     Choosing a search algorithm
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Search Algorithms</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Sections </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Dataset-Provider">
   Dataset Provider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Search-objectives">
   Search objectives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Choosing-a-search-algorithm">
     Choosing a search algorithm
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Search-Algorithms">
<h1>Search Algorithms<a class="headerlink" href="#Search-Algorithms" title="Permalink to this headline">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">overrides</span> <span class="kn">import</span> <span class="n">overrides</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search</span> <span class="kn">import</span> <span class="n">ArchaiModel</span><span class="p">,</span> <span class="n">EvolutionarySearchSpace</span><span class="p">,</span> <span class="n">BayesOptSearchSpace</span>
</pre></div>
</div>
</div>
<p>We will re-use the CNN search space created in the <a class="reference internal" href="search_space.html"><span class="doc">search space example</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span> <span class="o">=</span> <span class="n">CNNSearchSpace</span><span class="p">(</span><span class="n">max_layers</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kernel_list</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">hidden_list</span><span class="o">=</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ArchaiModel(
        archid=(3, 7, 32),
        metadata={},
        arch=MyModel(
  (model): Sequential(
    (0): Conv2d(1, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (1): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Conv2d(32, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (4): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (5): ReLU()
    (6): Conv2d(32, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (7): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (8): ReLU()
    (9): AdaptiveAvgPool2d(output_size=(1, 1))
    (10): Conv2d(32, 10, kernel_size=(1, 1), stride=(1, 1))
  )
)
)
</pre></div></div>
</div>
<section id="Dataset-Provider">
<h2>Dataset Provider<a class="headerlink" href="#Dataset-Provider" title="Permalink to this headline">#</a></h2>
<p>Datasets are represented in Archai throught the <code class="docutils literal notranslate"><span class="pre">`DatasetProvider</span></code> &lt;../../reference/api/archai.discrete_search.api.rst&gt;`__ class. For this example, we will use the built-in dataset provider of the MNIST dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">archai.datasets.providers.mnist_provider</span> <span class="kn">import</span> <span class="n">MnistProvider</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_provider</span> <span class="o">=</span> <span class="n">MnistProvider</span><span class="p">({</span><span class="s1">&#39;dataroot&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;dataroot&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>We can get train/test PyTorch datasets from a DatasetProvider by calling <code class="docutils literal notranslate"><span class="pre">dataset_provider.get_datasets(load_train,</span> <span class="pre">load_test,</span> <span class="pre">transforms_train,</span> <span class="pre">transforms_test)</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loads only the training set</span>
<span class="n">tr_d</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataset_provider</span><span class="o">.</span><span class="n">get_datasets</span><span class="p">(</span><span class="n">load_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">load_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_test</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(Dataset MNIST
     Number of datapoints: 60000
     Root location: /home/pkauffmann/dataroot
     Split: Train,
 None)
</pre></div></div>
</div>
</section>
<section id="Search-objectives">
<h2>Search objectives<a class="headerlink" href="#Search-objectives" title="Permalink to this headline">#</a></h2>
<p>We will use partial trainig validation accuracy as a proxy for task performance</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search</span> <span class="kn">import</span> <span class="n">Objective</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.objectives.onnx_model</span> <span class="kn">import</span> <span class="n">AvgOnnxLatency</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.objectives.torch_model</span> <span class="kn">import</span> <span class="n">TorchFlops</span><span class="p">,</span> <span class="n">TorchNumParameters</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.objectives.ray</span> <span class="kn">import</span> <span class="n">RayParallelObjective</span>

<span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">ToTensor</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="k">class</span> <span class="nc">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">Objective</span><span class="p">):</span>
    <span class="n">higher_is_better</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_epochs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
                 <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">=</span> <span class="n">training_epochs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span> <span class="o">=</span> <span class="n">ToTensor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="n">progress_bar</span>

    <span class="nd">@overrides</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="p">,</span> <span class="n">budget</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># Loads the dataset</span>
        <span class="n">tr_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataset_provider</span><span class="o">.</span><span class="n">get_datasets</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Train-validation split</span>
        <span class="n">tr_data</span><span class="p">,</span> <span class="n">val_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span>
            <span class="n">tr_data</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tr_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">],</span>
            <span class="n">generator</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">()</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">tr_dl</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">tr_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">val_dl</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">val_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Training settings</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>

        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Partial training</span>
        <span class="n">epoch_iter</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
            <span class="n">epoch_iter</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">epoch_iter</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Training model </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">archid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch_nb</span> <span class="ow">in</span> <span class="n">epoch_iter</span><span class="p">:</span>
            <span class="c1"># Early stops for fractional values of training epochs (e.g, 0.2)</span>
            <span class="n">early_stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">-</span> <span class="n">epoch_nb</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">early_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">-</span> <span class="n">epoch_nb</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">early_stop</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

                <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>

                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Evaluates final model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">val_pred</span><span class="p">,</span> <span class="n">val_target</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">val_dl</span><span class="p">:</span>
                <span class="n">val_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span>
                <span class="n">val_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span>

            <span class="n">val_pred</span><span class="p">,</span> <span class="n">val_target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">val_acc</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_pred</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="o">==</span> <span class="n">val_target</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Returns model to cpu</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">val_acc</span>
</pre></div>
</div>
</div>
<p>Let’s test our objective:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_tr</span> <span class="o">=</span> <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="n">partial_tr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Training model (5, 3, 64): 100%|███████████████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  2.66it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.12
</pre></div></div>
</div>
<p>We can make this objective more efficient evaluating multiple architectures in parallel. To do that, we can use the <code class="docutils literal notranslate"><span class="pre">RayParallelObjective</span></code> wrapper mentioned in the <a class="reference internal" href="objectives.html"><span class="doc">previous example</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_partial_tr</span> <span class="o">=</span> <span class="n">RayParallelObjective</span><span class="p">(</span><span class="n">partial_tr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s test our partial training objective sending two random architectures</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2022-12-12 13:22:45,865 INFO worker.py:1518 -- Started a local Ray instance.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Training model (8, 5, 128):   0%|          | 0/1 [00:00&lt;?, ?it/s]
Training model (7, 3, 32):   0%|          | 0/1 [00:00&lt;?, ?it/s]
Training model (7, 3, 32): 100%|██████████| 1/1 [00:00&lt;00:00,  2.87it/s]
Training model (8, 5, 128): 100%|██████████| 1/1 [00:07&lt;00:00,  7.12s/it]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.12, 0.1]
</pre></div></div>
</div>
<p>To run the same objective distributing jobs across multiple GPUs, just set the <code class="docutils literal notranslate"><span class="pre">num_gpus</span></code> parameter from <a class="reference external" href="https://docs.ray.io/en/latest/ray-core/package-ref.html#ray-init">ray.init</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RayParallelObjective</span><span class="p">(</span>
    <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">num_gpus</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 2 jobs per gpu available</span>
    <span class="n">max_calls</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now let’s wrap up and choose the objective functions we want to optimize</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Search objectives are defined as a dictionary of Objectives</span>
<span class="n">objectives</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Onnx Latency (ms)&#39;</span><span class="p">:</span> <span class="n">AvgOnnxLatency</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="s1">&#39;FLops&#39;</span><span class="p">:</span> <span class="n">TorchFlops</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span>

    <span class="c1"># To speed evaluation, we&#39;ll train multiple models in parallel</span>
    <span class="s1">&#39;Partial training Validation Accuracy&#39;</span><span class="p">:</span> <span class="n">RayParallelObjective</span><span class="p">(</span>
        <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span>
        <span class="n">num_gpus</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 2 jobs per gpu available</span>
        <span class="n">max_calls</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<section id="Choosing-a-search-algorithm">
<h3>Choosing a search algorithm<a class="headerlink" href="#Choosing-a-search-algorithm" title="Permalink to this headline">#</a></h3>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">EvolutionParetoSearch</span></code> first</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.algos.evolution_pareto</span> <span class="kn">import</span> <span class="n">EvolutionParetoSearch</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">EvolutionParetoSearch</span><span class="p">(</span>
    <span class="n">search_space</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span> <span class="n">objectives</span><span class="o">=</span><span class="n">objectives</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="o">=</span><span class="n">dataset_provider</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./out_evo2&#39;</span><span class="p">,</span> <span class="n">num_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_crossovers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mutations_per_parent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_unseen_population</span><span class="o">=</span><span class="mi">15</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
13:23 Using 10 random architectures as the initial population
13:23 starting evolution pareto iter 0
13:23 iter 0: calculating search objectives {&#39;Onnx Latency (ms)&#39;: &lt;archai.discrete_search.objectives.onnx_model.AvgOnnxLatency object at 0x7f7204a6f2e0&gt;, &#39;FLops&#39;: &lt;archai.discrete_search.objectives.torch_model.TensorwatchStat object at 0x7f70b3b7d160&gt;, &#39;Partial training Validation Accuracy&#39;: &lt;archai.discrete_search.objectives.ray.RayParallelObjective object at 0x7f7204a6f5b0&gt;} for 10 models
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 10/10 [00:00&lt;00:00, 125.44it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 10/10 [00:01&lt;00:00,  6.11it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 10/10 [00:00&lt;00:00, 127.40it/s]
Gathering results from async objectives...: 100%|██████████████████████████████████████████████████████████| 1/1 [01:13&lt;00:00, 73.56s/it]
13:24 iter 0: updating the pareto
13:24 iter 0: found 8 members
13:24 iter 0: chose 8 parents
13:24 iter 0: number of parents after objective fn. filter = 8
Mutating parents: 100%|████████████████████████████████████████████████████████████████████████████████████| 8/8 [00:00&lt;00:00, 52.45it/s]
13:24 iter 0: mutation yielded 15 new models
13:24 iter 0: crossover yielded 3 new models
13:24 iter 0: total unseen population before restriction 23
13:24 iter 0: total unseen population after restriction 15
13:24 starting evolution pareto iter 1
13:24 iter 1: calculating search objectives {&#39;Onnx Latency (ms)&#39;: &lt;archai.discrete_search.objectives.onnx_model.AvgOnnxLatency object at 0x7f7204a6f2e0&gt;, &#39;FLops&#39;: &lt;archai.discrete_search.objectives.torch_model.TensorwatchStat object at 0x7f70b3b7d160&gt;, &#39;Partial training Validation Accuracy&#39;: &lt;archai.discrete_search.objectives.ray.RayParallelObjective object at 0x7f7204a6f5b0&gt;} for 15 models
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 15/15 [00:00&lt;00:00, 204.20it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 15/15 [00:02&lt;00:00,  6.58it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 164.41it/s]
Gathering results from async objectives...: 100%|██████████████████████████████████████████████████████████| 1/1 [01:35&lt;00:00, 95.11s/it]
13:26 iter 1: updating the pareto
13:26 iter 1: found 13 members
13:26 iter 1: chose 13 parents
13:26 iter 1: number of parents after objective fn. filter = 13
Mutating parents: 100%|██████████████████████████████████████████████████████████████████████████████████| 13/13 [00:00&lt;00:00, 42.21it/s]
13:26 iter 1: mutation yielded 21 new models
13:26 iter 1: crossover yielded 2 new models
13:26 iter 1: total unseen population before restriction 28
13:26 iter 1: total unseen population after restriction 15
13:26 starting evolution pareto iter 2
13:26 iter 2: calculating search objectives {&#39;Onnx Latency (ms)&#39;: &lt;archai.discrete_search.objectives.onnx_model.AvgOnnxLatency object at 0x7f7204a6f2e0&gt;, &#39;FLops&#39;: &lt;archai.discrete_search.objectives.torch_model.TensorwatchStat object at 0x7f70b3b7d160&gt;, &#39;Partial training Validation Accuracy&#39;: &lt;archai.discrete_search.objectives.ray.RayParallelObjective object at 0x7f7204a6f5b0&gt;} for 15 models
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 15/15 [00:00&lt;00:00, 169.87it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 15/15 [00:02&lt;00:00,  6.71it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 150.51it/s]
Gathering results from async objectives...: 100%|██████████████████████████████████████████████████████████| 1/1 [01:25&lt;00:00, 85.54s/it]
13:28 iter 2: updating the pareto
13:28 iter 2: found 20 members
13:28 iter 2: chose 20 parents
13:28 iter 2: number of parents after objective fn. filter = 20
Mutating parents: 100%|██████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 35.35it/s]
13:28 iter 2: mutation yielded 26 new models
13:28 iter 2: crossover yielded 3 new models
13:28 iter 2: total unseen population before restriction 34
13:28 iter 2: total unseen population after restriction 15
13:28 starting evolution pareto iter 3
13:28 iter 3: calculating search objectives {&#39;Onnx Latency (ms)&#39;: &lt;archai.discrete_search.objectives.onnx_model.AvgOnnxLatency object at 0x7f7204a6f2e0&gt;, &#39;FLops&#39;: &lt;archai.discrete_search.objectives.torch_model.TensorwatchStat object at 0x7f70b3b7d160&gt;, &#39;Partial training Validation Accuracy&#39;: &lt;archai.discrete_search.objectives.ray.RayParallelObjective object at 0x7f7204a6f5b0&gt;} for 15 models
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 15/15 [00:00&lt;00:00, 103.01it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 15/15 [00:03&lt;00:00,  4.86it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 113.84it/s]
Gathering results from async objectives...: 100%|█████████████████████████████████████████████████████████| 1/1 [02:07&lt;00:00, 127.19s/it]
13:30 iter 3: updating the pareto
13:30 iter 3: found 22 members
13:30 iter 3: chose 22 parents
13:30 iter 3: number of parents after objective fn. filter = 22
Mutating parents: 100%|██████████████████████████████████████████████████████████████████████████████████| 22/22 [00:00&lt;00:00, 31.26it/s]
13:30 iter 3: mutation yielded 23 new models
13:30 iter 3: crossover yielded 0 new models
13:30 iter 3: total unseen population before restriction 28
13:30 iter 3: total unseen population after restriction 15
13:30 starting evolution pareto iter 4
13:30 iter 4: calculating search objectives {&#39;Onnx Latency (ms)&#39;: &lt;archai.discrete_search.objectives.onnx_model.AvgOnnxLatency object at 0x7f7204a6f2e0&gt;, &#39;FLops&#39;: &lt;archai.discrete_search.objectives.torch_model.TensorwatchStat object at 0x7f70b3b7d160&gt;, &#39;Partial training Validation Accuracy&#39;: &lt;archai.discrete_search.objectives.ray.RayParallelObjective object at 0x7f7204a6f5b0&gt;} for 15 models
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 15/15 [00:00&lt;00:00, 107.96it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 15/15 [00:02&lt;00:00,  5.13it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 110.59it/s]
Gathering results from async objectives...: 100%|█████████████████████████████████████████████████████████| 1/1 [02:14&lt;00:00, 134.48s/it]
13:32 iter 4: updating the pareto
13:32 iter 4: found 25 members
13:32 iter 4: chose 25 parents
13:32 iter 4: number of parents after objective fn. filter = 25
Mutating parents: 100%|██████████████████████████████████████████████████████████████████████████████████| 25/25 [00:00&lt;00:00, 25.92it/s]
13:32 iter 4: mutation yielded 21 new models
13:32 iter 4: crossover yielded 0 new models
13:32 iter 4: total unseen population before restriction 26
13:32 iter 4: total unseen population after restriction 15
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_1.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_2.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_3.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_4.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_5.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_6.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_7.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_8.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_9.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_10.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_11.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_12.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_13.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_14.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_14.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_15.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_31_15.png" />
</div>
</div>
<p>By default all algorithms will save the final pareto architectures <code class="docutils literal notranslate"><span class="pre">pareto_models_iter_*/</span></code>, pareto evolution plots <code class="docutils literal notranslate"><span class="pre">pareto_*.png</span></code> and search state tables with all the results <code class="docutils literal notranslate"><span class="pre">search_state_*.csv</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="o">!</span>ls /tmp/out_evo2
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
log.log
pareto_FLops_vs_Partial_training_Validation_Accuracy.png
pareto_models_iter_1
pareto_models_iter_2
pareto_models_iter_3
pareto_models_iter_4
pareto_models_iter_5
pareto_Onnx_Latency_ms_vs_FLops.png
pareto_Onnx_Latency_ms_vs_Partial_training_Validation_Accuracy.png
search_state_1.csv
search_state_2.csv
search_state_3.csv
search_state_4.csv
search_state_5.csv
</pre></div></div>
</div>
<p>You can also get information from the <code class="docutils literal notranslate"><span class="pre">search_results</span></code> object</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results</span><span class="o">.</span><span class="n">get_search_state_df</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;is_pareto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Partial training Validation Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>archid</th>
      <th>Onnx Latency (ms)</th>
      <th>FLops</th>
      <th>Partial training Validation Accuracy</th>
      <th>parent</th>
      <th>parents</th>
      <th>iteration_num</th>
      <th>Search walltime (hours)</th>
      <th>is_pareto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25</th>
      <td>(1, 3, 32)</td>
      <td>0.000228</td>
      <td>353386.0</td>
      <td>0.256</td>
      <td>(1, 3, 128)</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>59</th>
      <td>(1, 5, 32)</td>
      <td>0.000288</td>
      <td>754794.0</td>
      <td>0.264</td>
      <td>(1, 3, 128)</td>
      <td>None</td>
      <td>4</td>
      <td>0.147950</td>
      <td>True</td>
    </tr>
    <tr>
      <th>23</th>
      <td>(1, 5, 64)</td>
      <td>0.000216</td>
      <td>1509578.0</td>
      <td>0.267</td>
      <td>(1, 5, 128)</td>
      <td>None</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(1, 3, 128)</td>
      <td>0.000253</td>
      <td>1413514.0</td>
      <td>0.287</td>
      <td>None</td>
      <td>(8, 3, 64),(1, 7, 128)</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(1, 7, 32)</td>
      <td>0.000261</td>
      <td>1356906.0</td>
      <td>0.300</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.020952</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1, 3, 128)</td>
      <td>0.000262</td>
      <td>1413514.0</td>
      <td>0.304</td>
      <td>(1, 7, 128)</td>
      <td>None</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(1, 5, 128)</td>
      <td>0.000234</td>
      <td>3019146.0</td>
      <td>0.337</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.020952</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31</th>
      <td>(1, 7, 64)</td>
      <td>0.000242</td>
      <td>2713802.0</td>
      <td>0.348</td>
      <td>(1, 7, 128)</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(1, 7, 128)</td>
      <td>0.000274</td>
      <td>5427594.0</td>
      <td>0.428</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.020952</td>
      <td>True</td>
    </tr>
    <tr>
      <th>32</th>
      <td>(3, 3, 32)</td>
      <td>0.000305</td>
      <td>15004778.0</td>
      <td>0.708</td>
      <td>(4, 3, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(4, 3, 32)</td>
      <td>0.000542</td>
      <td>22330474.0</td>
      <td>0.838</td>
      <td>(4, 7, 32)</td>
      <td>None</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(5, 3, 32)</td>
      <td>0.000646</td>
      <td>29656170.0</td>
      <td>0.924</td>
      <td>(4, 7, 32)</td>
      <td>None</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>30</th>
      <td>(5, 3, 32)</td>
      <td>0.000910</td>
      <td>29656170.0</td>
      <td>0.926</td>
      <td>None</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>41</th>
      <td>(3, 5, 32)</td>
      <td>0.000502</td>
      <td>41096298.0</td>
      <td>0.944</td>
      <td>(6, 5, 32)</td>
      <td>None</td>
      <td>3</td>
      <td>0.109376</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(6, 3, 32)</td>
      <td>0.000642</td>
      <td>36981866.0</td>
      <td>0.950</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.020952</td>
      <td>True</td>
    </tr>
    <tr>
      <th>67</th>
      <td>(7, 3, 32)</td>
      <td>0.000660</td>
      <td>44307562.0</td>
      <td>0.954</td>
      <td>(4, 5, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.147950</td>
      <td>True</td>
    </tr>
    <tr>
      <th>36</th>
      <td>(4, 5, 32)</td>
      <td>0.000524</td>
      <td>61267050.0</td>
      <td>0.967</td>
      <td>None</td>
      <td>(4, 3, 32),(6, 5, 32)</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>64</th>
      <td>(3, 7, 32)</td>
      <td>0.000726</td>
      <td>80233578.0</td>
      <td>0.972</td>
      <td>(5, 3, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.147950</td>
      <td>True</td>
    </tr>
    <tr>
      <th>35</th>
      <td>(9, 3, 32)</td>
      <td>0.000757</td>
      <td>58958954.0</td>
      <td>0.976</td>
      <td>(8, 3, 128)</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>40</th>
      <td>(5, 5, 32)</td>
      <td>0.000650</td>
      <td>81437802.0</td>
      <td>0.977</td>
      <td>(6, 5, 32)</td>
      <td>None</td>
      <td>3</td>
      <td>0.109376</td>
      <td>True</td>
    </tr>
    <tr>
      <th>33</th>
      <td>(6, 5, 32)</td>
      <td>0.000701</td>
      <td>101608554.0</td>
      <td>0.981</td>
      <td>None</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(6, 5, 32)</td>
      <td>0.000753</td>
      <td>101608554.0</td>
      <td>0.986</td>
      <td>(6, 3, 32)</td>
      <td>None</td>
      <td>1</td>
      <td>0.048188</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>(6, 5, 64)</td>
      <td>0.001397</td>
      <td>403921098.0</td>
      <td>0.989</td>
      <td>(2, 5, 64)</td>
      <td>None</td>
      <td>2</td>
      <td>0.072800</td>
      <td>True</td>
    </tr>
    <tr>
      <th>66</th>
      <td>(6, 7, 32)</td>
      <td>0.001524</td>
      <td>198548586.0</td>
      <td>0.989</td>
      <td>(9, 7, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.147950</td>
      <td>True</td>
    </tr>
    <tr>
      <th>44</th>
      <td>(9, 5, 64)</td>
      <td>0.001756</td>
      <td>645368010.0</td>
      <td>0.992</td>
      <td>(6, 5, 64)</td>
      <td>None</td>
      <td>3</td>
      <td>0.109376</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Since our search space is also compatible with Bayesian Optimization algorithms, let’s try more sophisticated algorithm like MO-BANANAS</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.algos.bananas</span> <span class="kn">import</span> <span class="n">MoBananasSearch</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algo2</span> <span class="o">=</span> <span class="n">MoBananasSearch</span><span class="p">(</span>
    <span class="n">search_space</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span> <span class="n">objectives</span><span class="o">=</span><span class="n">objectives</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="o">=</span><span class="n">dataset_provider</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;/tmp/out_bananas&#39;</span><span class="p">,</span>
    <span class="n">cheap_objectives</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Onnx Latency (ms)&#39;</span><span class="p">,</span> <span class="s1">&#39;FLops&#39;</span><span class="p">],</span> <span class="c1"># Cheap objectives won&#39;t be predicted by the surrogate model</span>
    <span class="n">num_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mutations_per_parent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_mutations</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results2</span> <span class="o">=</span> <span class="n">algo2</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
13:32 Starting iteration 0
13:32 Evaluating objectives for 10 architectures
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 10/10 [00:00&lt;00:00, 143.76it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 10/10 [00:01&lt;00:00,  6.28it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 10/10 [00:00&lt;00:00, 149.74it/s]
Gathering results from async objectives...: 100%|██████████████████████████████████████████████████████████| 1/1 [01:13&lt;00:00, 73.43s/it]
13:33 Updating surrogate model...
Training DNN Ensemble...: 100%|████████████████████████████████████████████████████████████████████████████| 5/5 [00:25&lt;00:00,  5.17s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
13:34 Generating mutations for 10 parent architectures...
13:34 Predicting objectives [&#39;Partial training Validation Accuracy&#39;] using surrogate model
13:34 Calculating cheap objectives [&#39;Onnx Latency (ms)&#39;, &#39;FLops&#39;]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 18/18 [00:03&lt;00:00,  5.67it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 18/18 [00:00&lt;00:00, 132.93it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
13:34 20 candidate architectures were selected for the next iteration
13:34 Starting iteration 1
13:34 Evaluating objectives for 18 architectures
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|███████████████████████████████████| 18/18 [00:00&lt;00:00, 132.09it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|████████████████████████████████████████████████████████████████| 18/18 [00:03&lt;00:00,  5.36it/s]
Calculating &#34;FLops&#34;...: 100%|███████████████████████████████████████████████████████████████████████████| 18/18 [00:00&lt;00:00, 116.20it/s]
Gathering results from async objectives...: 100%|█████████████████████████████████████████████████████████| 1/1 [02:23&lt;00:00, 143.61s/it]
13:36 Updating surrogate model...
Training DNN Ensemble...: 100%|███████████████████████████████████████████████████████████████████████████████| 5/5 [00:25&lt;00:00,  5.02s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
13:37 Generating mutations for 10 parent architectures...
13:37 Predicting objectives [&#39;Partial training Validation Accuracy&#39;] using surrogate model
13:37 Calculating cheap objectives [&#39;Onnx Latency (ms)&#39;, &#39;FLops&#39;]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|██████████████████████████████████████████████████████████████████████| 15/15 [00:02&lt;00:00,  5.32it/s]
Calculating &#34;FLops&#34;...: 100%|█████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 139.75it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
13:37 20 candidate architectures were selected for the next iteration
13:37 Starting iteration 2
13:37 Evaluating objectives for 15 architectures
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|█████████████████████████████████████████| 15/15 [00:00&lt;00:00, 141.85it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|██████████████████████████████████████████████████████████████████████| 15/15 [00:02&lt;00:00,  5.04it/s]
Calculating &#34;FLops&#34;...: 100%|█████████████████████████████████████████████████████████████████████████████████| 15/15 [00:00&lt;00:00, 120.91it/s]
Gathering results from async objectives...: 100%|████████████████████████████████████████████████████████████████| 1/1 [01:36&lt;00:00, 96.17s/it]
13:38 Updating surrogate model...
Training DNN Ensemble...: 100%|███████████████████████████████████████████████████████████████| 5/5 [00:25&lt;00:00,  5.01s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
13:39 Generating mutations for 10 parent architectures...
13:39 Predicting objectives [&#39;Partial training Validation Accuracy&#39;] using surrogate model
13:39 Calculating cheap objectives [&#39;Onnx Latency (ms)&#39;, &#39;FLops&#39;]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|███████████████████████████████████████████████████| 10/10 [00:01&lt;00:00,  8.96it/s]
Calculating &#34;FLops&#34;...: 100%|██████████████████████████████████████████████████████████████| 10/10 [00:00&lt;00:00, 234.71it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
13:39 20 candidate architectures were selected for the next iteration
13:39 Starting iteration 3
13:39 Evaluating objectives for 10 architectures
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|██████████████████████| 10/10 [00:00&lt;00:00, 204.74it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|███████████████████████████████████████████████████| 10/10 [00:01&lt;00:00,  8.09it/s]
Calculating &#34;FLops&#34;...: 100%|██████████████████████████████████████████████████████████████| 10/10 [00:00&lt;00:00, 230.63it/s]
Gathering results from async objectives...: 100%|█████████████████████████████████████████████| 1/1 [01:01&lt;00:00, 61.81s/it]
13:40 Updating surrogate model...
Training DNN Ensemble...: 100%|███████████████████████████████████████████████████████████████████████████████| 5/5 [00:25&lt;00:00,  5.08s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
13:40 Generating mutations for 10 parent architectures...
13:40 Predicting objectives [&#39;Partial training Validation Accuracy&#39;] using surrogate model
13:40 Calculating cheap objectives [&#39;Onnx Latency (ms)&#39;, &#39;FLops&#39;]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|█████████████████████████████████████████████████████████████████████| 7/7 [00:01&lt;00:00,  6.87it/s]
Calculating &#34;FLops&#34;...: 100%|████████████████████████████████████████████████████████████████████████████████| 7/7 [00:00&lt;00:00, 157.47it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
13:40 20 candidate architectures were selected for the next iteration
13:40 Starting iteration 4
13:40 Evaluating objectives for 7 architectures
Dispatching jobs for &#34;Partial training Validation Accuracy&#34;...: 100%|████████████████████████████████████████| 7/7 [00:00&lt;00:00, 169.26it/s]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|█████████████████████████████████████████████████████████████████████| 7/7 [00:01&lt;00:00,  6.29it/s]
Calculating &#34;FLops&#34;...: 100%|████████████████████████████████████████████████████████████████████████████████| 7/7 [00:00&lt;00:00, 134.19it/s]
Gathering results from async objectives...: 100%|█████████████████████████████████████████████████████████████| 1/1 [00:54&lt;00:00, 54.53s/it]
13:41 Updating surrogate model...
Training DNN Ensemble...: 100%|███████████████████████████████████████████████████████████████████████████████| 5/5 [00:25&lt;00:00,  5.01s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
13:42 Generating mutations for 10 parent architectures...
13:42 Predicting objectives [&#39;Partial training Validation Accuracy&#39;] using surrogate model
13:42 Calculating cheap objectives [&#39;Onnx Latency (ms)&#39;, &#39;FLops&#39;]
Calculating &#34;Onnx Latency (ms)&#34;...: 100%|███████████████████████████████████████████████████████████████████| 10/10 [00:01&lt;00:00,  5.66it/s]
Calculating &#34;FLops&#34;...: 100%|██████████████████████████████████████████████████████████████████████████████| 10/10 [00:00&lt;00:00, 142.04it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
13:42 20 candidate architectures were selected for the next iteration
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_1.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_2.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_3.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_4.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_5.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_6.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_7.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_8.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_9.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_10.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_11.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_12.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_13.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_14.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_14.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_15.png" src="../../../_images/basic_guide_notebooks_discrete_search_search_algos_39_15.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="o">!</span>ls /tmp/out_bananas
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
log.log
pareto_FLops_vs_Partial_training_Validation_Accuracy.png
pareto_Onnx_Latency_ms_vs_FLops.png
pareto_Onnx_Latency_ms_vs_Partial_training_Validation_Accuracy.png
search_state_0.csv
search_state_1.csv
search_state_2.csv
search_state_3.csv
search_state_4.csv
</pre></div></div>
</div>
<p>MO-BANANAS will also save the predictive mean and variance of the expensive objectives (in this case <code class="docutils literal notranslate"><span class="pre">Predicted</span> <span class="pre">Partial</span> <span class="pre">training</span> <span class="pre">Validation</span> <span class="pre">Accuracy</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results2</span><span class="o">.</span><span class="n">get_search_state_df</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;is_pareto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Partial training Validation Accuracy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>archid</th>
      <th>Onnx Latency (ms)</th>
      <th>FLops</th>
      <th>Partial training Validation Accuracy</th>
      <th>iteration_num</th>
      <th>Predicted Partial training Validation Accuracy mean</th>
      <th>Predicted Partial training Validation Accuracy var</th>
      <th>Search walltime (hours)</th>
      <th>is_pareto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28</th>
      <td>(1, 3, 64)</td>
      <td>0.000239</td>
      <td>706762.0</td>
      <td>0.251</td>
      <td>2</td>
      <td>0.313004</td>
      <td>0.000360</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1, 3, 32)</td>
      <td>0.000252</td>
      <td>353386.0</td>
      <td>0.255</td>
      <td>1</td>
      <td>0.602352</td>
      <td>0.005347</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29</th>
      <td>(1, 5, 32)</td>
      <td>0.000245</td>
      <td>754794.0</td>
      <td>0.289</td>
      <td>2</td>
      <td>0.457042</td>
      <td>0.001704</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>54</th>
      <td>(1, 5, 64)</td>
      <td>0.000246</td>
      <td>1509578.0</td>
      <td>0.296</td>
      <td>4</td>
      <td>0.397546</td>
      <td>0.002552</td>
      <td>0.153856</td>
      <td>True</td>
    </tr>
    <tr>
      <th>44</th>
      <td>(1, 7, 32)</td>
      <td>0.000262</td>
      <td>1356906.0</td>
      <td>0.303</td>
      <td>3</td>
      <td>0.698000</td>
      <td>0.011878</td>
      <td>0.130883</td>
      <td>True</td>
    </tr>
    <tr>
      <th>43</th>
      <td>(1, 5, 128)</td>
      <td>0.000262</td>
      <td>3019146.0</td>
      <td>0.307</td>
      <td>3</td>
      <td>0.617455</td>
      <td>0.002025</td>
      <td>0.130883</td>
      <td>True</td>
    </tr>
    <tr>
      <th>53</th>
      <td>(1, 7, 128)</td>
      <td>0.000278</td>
      <td>5427594.0</td>
      <td>0.377</td>
      <td>4</td>
      <td>0.536954</td>
      <td>0.001538</td>
      <td>0.153856</td>
      <td>True</td>
    </tr>
    <tr>
      <th>49</th>
      <td>(2, 3, 32)</td>
      <td>0.000349</td>
      <td>7679082.0</td>
      <td>0.461</td>
      <td>3</td>
      <td>0.448850</td>
      <td>0.000029</td>
      <td>0.130883</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(3, 3, 32)</td>
      <td>0.000466</td>
      <td>15004778.0</td>
      <td>0.640</td>
      <td>1</td>
      <td>0.773703</td>
      <td>0.000529</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(2, 5, 32)</td>
      <td>0.000419</td>
      <td>20925546.0</td>
      <td>0.651</td>
      <td>1</td>
      <td>0.873010</td>
      <td>0.001508</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>50</th>
      <td>(2, 5, 64)</td>
      <td>0.000438</td>
      <td>81991882.0</td>
      <td>0.833</td>
      <td>3</td>
      <td>0.576228</td>
      <td>0.001088</td>
      <td>0.130883</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(4, 3, 32)</td>
      <td>0.000473</td>
      <td>22330474.0</td>
      <td>0.868</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.020898</td>
      <td>True</td>
    </tr>
    <tr>
      <th>34</th>
      <td>(3, 5, 32)</td>
      <td>0.000536</td>
      <td>41096298.0</td>
      <td>0.946</td>
      <td>2</td>
      <td>0.835108</td>
      <td>0.001988</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>47</th>
      <td>(6, 3, 32)</td>
      <td>0.000689</td>
      <td>36981866.0</td>
      <td>0.961</td>
      <td>3</td>
      <td>0.959455</td>
      <td>0.000036</td>
      <td>0.130883</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31</th>
      <td>(4, 5, 32)</td>
      <td>0.000550</td>
      <td>61267050.0</td>
      <td>0.963</td>
      <td>2</td>
      <td>0.942770</td>
      <td>0.001834</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(7, 3, 32)</td>
      <td>0.000740</td>
      <td>44307562.0</td>
      <td>0.967</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.020898</td>
      <td>True</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(8, 3, 32)</td>
      <td>0.000789</td>
      <td>51633258.0</td>
      <td>0.970</td>
      <td>1</td>
      <td>0.983521</td>
      <td>0.000020</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(10, 3, 32)</td>
      <td>0.001126</td>
      <td>66284650.0</td>
      <td>0.973</td>
      <td>1</td>
      <td>1.017302</td>
      <td>0.000132</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(6, 5, 32)</td>
      <td>0.000773</td>
      <td>101608554.0</td>
      <td>0.979</td>
      <td>1</td>
      <td>0.970922</td>
      <td>0.000009</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(7, 5, 32)</td>
      <td>0.001074</td>
      <td>121779306.0</td>
      <td>0.980</td>
      <td>1</td>
      <td>0.987013</td>
      <td>0.000029</td>
      <td>0.070371</td>
      <td>True</td>
    </tr>
    <tr>
      <th>35</th>
      <td>(8, 5, 32)</td>
      <td>0.001031</td>
      <td>141950058.0</td>
      <td>0.986</td>
      <td>2</td>
      <td>0.982395</td>
      <td>0.000008</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>38</th>
      <td>(10, 5, 32)</td>
      <td>0.001177</td>
      <td>182291562.0</td>
      <td>0.989</td>
      <td>2</td>
      <td>0.985368</td>
      <td>0.000053</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(6, 7, 32)</td>
      <td>0.001724</td>
      <td>198548586.0</td>
      <td>0.990</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.020898</td>
      <td>True</td>
    </tr>
    <tr>
      <th>39</th>
      <td>(10, 3, 64)</td>
      <td>0.001204</td>
      <td>262625482.0</td>
      <td>0.993</td>
      <td>2</td>
      <td>0.988335</td>
      <td>0.000012</td>
      <td>0.105893</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="objectives.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Objective functions</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="config_search.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Config Search Spaces</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft<br/>
  
      &copy; Copyright 2022.<br/>
    Last updated on Dec 16, 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>